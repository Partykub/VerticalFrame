# สรุปภาพรวมโปรเจกต์ Auto-Reframe

## 1. ภาพรวมโปรเจกต์ (Project Overview)
**Auto-Reframe** คือระบบอัตโนมัติสำหรับแปลงวิดีโอแนวนอน (Landscape) ให้เป็นวิดีโอแนวตั้ง (Portrait 9:16) โดยใช้ AI ในการตรวจจับและติดตามจุดสนใจ (Subject) เพื่อให้ได้ภาพที่องค์ประกอบสวยงาม เหมาะสำหรับการนำไปลง Social Media เช่น TikTok, Reels หรือ Shorts

## 2. สถาปัตยกรรมระบบ (System Architecture)
ระบบถูกออกแบบโดยแบ่งหน้าที่เป็น 4 ส่วนหลัก เปรียบเสมือนร่างกายมนุษย์:

### 1. Eyes (ส่วนรับภาพ) - `modules/eyes`
ทำหน้าที่ "มองเห็น" และระบุตำแหน่งวัตถุ:
- **MediaPipe**: ตรวจจับใบหน้า (Face Detection) มีความแม่นยำสูง
- **YOLOv8**: ตรวจจับบุคคล (Body) และวัตถุต่างๆ ทำงานบน GPU ได้
- **Saliency**: ตรวจจับความโดดเด่นของภาพ (แสง/การเคลื่อนไหว) เป็นระบบสำรองเมื่อไม่เจอคน

### 2. Memory (ส่วนความจำ) - `modules/memory`
ทำหน้าที่ "จดจำ" สิ่งที่เห็น:
- **DeepSort**: ระบบติดตามวัตถุ (Object Tracker) ช่วยจำ ID ของบุคคล ทำให้กล้องไม่สลับเป้าหมายไปมามั่วซั่ว

### 3. Brain (ส่วนสมอง) - `modules/brain`
ทำหน้าที่ "ตัดสินใจ" และ "วางแผน":
- **Hybrid Strategy**: ตรรกะหลักในการเลือกจุดโฟกัส โดยเรียงลำดับความสำคัญดังนี้:
  1. **Face**: สำคัญที่สุด (ต้องชัดเจน ค่าความคมชัด > 15.0)
  2. **Body**: รองลงมา (ใช้ ID จาก DeepSort)
  3. **Interest Object**: วัตถุที่สนใจ (เช่น สัตว์เลี้ยง, สิ่งของ)
  4. **Saliency**: แผนสุดท้ายเมื่อไม่มีคน
- **Trajectory Planner**: คำนวณเส้นทางการเคลื่อนกล้องให้นุ่มนวล (Smoothing) ลดอาการภาพสั่นไหว

### 4. Limbs (ส่วนแขนขา) - `modules/limbs`
ทำหน้าที่ "ปฏิบัติงาน":
- **VideoProcessor**: ตัดส่วนภาพ (Crop) ตามพิกัดที่สมองสั่ง
- **FFmpeg**: รวมภาพที่ตัดแล้วเข้ากับเสียงต้นฉบับในขั้นตอนสุดท้าย

## 3. ฟีเจอร์หลัก (Key Features)
- **Hybrid Detection**: ผสมผสานความแม่นยำของ Face Detection เข้ากับความเสถียรของ Body Tracking
- **Smart Smoothing**: มีโหมด **Global Smoothing** ที่วิเคราะห์วิดีโอทั้งไฟล์ก่อนตัดจริง (2-Pass) เพื่อให้การแพนกล้องดูเป็นธรรมชาติแบบ Cinematic
- **Auto Audio Merge**: รวมเสียงจากต้นฉบับให้อัตโนมัติ ไม่ต้องไปตัดต่อเพิ่ม
- **Production Mode**: เลือกระหว่างโหมด Debug (ดูภาพเปรียบเทียบ) หรือ Production (เอาเฉพาะภาพผลลัพธ์)

## 4. ขั้นตอนการทำงาน (Workflow Roadmap)
อธิบายลำดับการทำงานของเครื่องมือภายในระบบ ตั้งแต่เริ่มรับไฟล์วิดีโอจนได้ผลลัพธ์:

1.  **Input & Decoding (OpenCV)**
    *   **หน้าที่**: รับไฟล์วิดีโอเข้ามาและแตกไฟล์ออกเป็นภาพทีละเฟรม (Frame-by-Frame)
    *   **เครื่องมือ**: `OpenCV (cv2.VideoCapture)`

2.  **Detection & Perception (MediaPipe + YOLO + Saliency)**
    *   **หน้าที่**: "มองหา" สิ่งที่น่าสนใจในภาพ
    *   **เครื่องมือ**:
        *   `MediaPipe`: ค้นหาใบหน้าและ Landmark บนหน้า (ละเอียดสุด)
        *   `YOLOv8`: ค้นหาตัวคน (Person) หรือวัตถุอื่นๆ (ทำหน้าที่เสริมเมื่อ MediaPipe ไม่เจอหน้า)
        *   `Saliency (OpenCV)`: วิเคราะห์ความโดดเด่นของพิกเซล (ใช้เมื่อไม่มีคนเลย)

3.  **Tracking & Identification (DeepSort)**
    *   **หน้าที่**: "จดจำ" ว่าคนที่เห็นในเฟรมนี้ คือคนเดียวกับเฟรมที่แล้วหรือไม่ (Assign ID)
    *   **เครื่องมือ**: `DeepSort`
    *   **ประโยชน์**: ช่วยให้กล้องติดตามคนเดิมได้อย่างต่อเนื่อง ไม่กระโดดไปมา

4.  **Decision Making (Hybrid Logic)**
    *   **หน้าที่**: "เลือก" ว่าจะโฟกัสที่ใครหรืออะไร (Face vs Body vs Object)
    *   **เครื่องมือ**: `Python Logic (NumPy)`
    *   **ตรรกะ**: ตรวจสอบคุณภาพความชัดของหน้า -> ถ้าชัดเลือกหน้า -> ถ้าไม่ชัดเลือกตัว -> ถ้าไม่มีคนเลือกวัตถุ -> ถ้าไม่มีอะไรเลยเลือกจุดเด่น

5.  **Path Planning & Smoothing (Math/NumPy)**
    *   **หน้าที่**: "คำนวณ" การเคลื่อนที่ของกล้องให้นุ่มนวล (Cinematic Movement)
    *   **เครื่องมือ**: `NumPy`
    *   **วิธีการ**: ใช้สูตรคณิตศาสตร์ (Moving Average / Gaussian) แปลงจุดโฟกัสที่ดิบๆ ให้เป็นเส้นโค้งที่นุ่มนวล

6.  **Rendering & Processing (OpenCV)**
    *   **หน้าที่**: "ตัดต่อ" ภาพจริงตามพิกัดที่คำนวณได้
    *   **เครื่องมือ**: `OpenCV (cv2.videoWriter)`
    *   **ผลลัพธ์**: ได้ไฟล์วิดีโอใบ้ (ไม่มีเสียง) ขนาด 9:16

7.  **Final Assembly (FFmpeg)**
    *   **หน้าที่**: "รวมร่าง" งานสุดท้าย
    *   **เครื่องมือ**: `FFmpeg`
    *   **การทำงาน**: ดึงเสียงคุณภาพสูงจากต้นฉบับ มาประกบกับวิดีโอที่ตัดเสร็จแล้ว เพื่อให้ได้ไฟล์ที่สมบูรณ์พร้อมใช้งาน

## 5. การใช้งาน (Usage)
คำสั่งพื้นฐานในการรันโปรแกรม:
```bash
python auto_reframe.py <video_path> [options]
```

**Options ที่น่าสนใจ:**
- `--strategy Hybrid`: ใช้ระบบสมองกลผสม (แนะนำ)
- `--smooth_mode Global`: คำนวณการเคลื่อนกล้องแบบทั้งคลิป (เนียนที่สุด)
- `--view_mode production`: บันทึกเฉพาะไฟล์ผลลัพธ์ 9:16
- `--cut_mode ID`: ตัดภาพทันทีเมื่อเปลี่ยนคนแสดง

**ตัวอย่าง:**
```bash
python auto_reframe.py video.mp4 --strategy Hybrid --smooth_mode Global --view_mode production
```

## 6. ข้อมูลทางเทคนิค (Technical Stack)
- **Language**: Python 3.10+
- **Core AI**: MediaPipe (Google), YOLOv8 (Ultralytics)
- **Image Processing**: OpenCV, NumPy
- **Multimedia**: FFmpeg
